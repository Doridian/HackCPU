MOV $ENCREG1 0xDEAD
MOV $ENCREG2 0xBEEF
ENCON
MOV @0 11
MOV @2 11
MOV @4 11
MOV @6 11
MOV @8 11
MOV $IHBASE 0
MOV $SP 0xFFDF
XOR $R1 $R1
XOR $R2 $R2
XOR $R3 $R3
XOR $R4 $R4
PUSH 1
INT 6
POP $R1
JNZ $R1 :haltme
POP $R1
CMP $R1 5
JL :haltme
PUSH 1
INT 7
MOV $R2 0xFFFF
SUB $R2 $R1
PUSH $R1
PUSH $R2
PUSH 1
INT 1
MOV $R4 $R2
SUB $R4 0x200
MOV $R3 $R4
MOV @$R3 0x0000
ADD $R3 2
MOV $SP $R4
SUB $SP 0x200
MOV $IHBASE $R4
MOV32 $R34 @$R2
MOV32 @$R2 0
XOR $R3 $ENCREG1
XOR $R4 $ENCREG2
ADD $R2 4
PUSH $R2
ENCOFF
MOV $ENCREG1 $R3
MOV $ENCREG2 $R4
XOR $R1 $R1
XOR $R2 $R2
XOR $R3 $R3
XOR $R4 $R4
JNZ $ENCREG1 :romwithenc
JNZ $ENCREG2 :romwithenc
RETN
:romwithenc
ENCRETN
:haltme
HALT
